#!/usr/bin/env bash

set -euo pipefail

if ! command -v brightnessctl &> /dev/null; then
  echo "Error: brightnessctl not found"
  exit 1
fi

case $1 in
  "up")
    {{- if eq .chezmoi.hostname "mighty" }}
    dms ipc call brightness increment 5 "backlight:intel_backlight"
    {{- else }}
    brightnessctl -e4 set 5%+ > /dev/null 2>&1
    {{- end }}
    ;;
  "down")
    {{- if eq .chezmoi.hostname "mighty" }}
    dms ipc call brightness decrement 5 "backlight:intel_backlight"
    {{- else }}
    brightnessctl -e4 set 5%- > /dev/null 2>&1
    {{- end }}
    ;;
  *)
    echo "Usage: $0 {up|down}"
    exit 1
    ;;
esac

{{- if eq .chezmoi.hostname "mighty" }}
notify-send -a "Brightness" -r 9999 -t 1000 \
  -i display-brightness-symbolic \
  "$(dms ipc call brightness status | grep -oP 'Brightness: \d+%')"
{{- else }}
percentage=$(brightnessctl -m | cut -d, -f4 | tr -d %)

notify-send -a "Brightness" -r 9999 -t 1000 \
  -i display-brightness-symbolic \
  "Brightness" "${percentage}%"
{{- end }}
