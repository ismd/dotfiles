#+title: GNU Emacs Config
#+author: Vladimir Kosteley
#+description: Personal Emacs config
#+startup: showeverything
#+options: toc:2

* Table of Contents :toc:
- [[#initial-setup][Initial Setup]]
  - [[#load-path][Load Path]]
  - [[#package-manager][Package Manager]]
  - [[#custom-file][Custom File]]
  - [[#fonts][Fonts]]
  - [[#themes][Themes]]
- [[#load-modules][Load Modules]]
- [[#daemon][Daemon]]

* Initial Setup
** Load Path
#+begin_src emacs-lisp
(add-to-list 'load-path "~/.config/emacs/lisp/")
#+end_src

** Package Manager
#+begin_src emacs-lisp
;; Allow upgrading built-in packages (project.el, eglot, etc.)
(setq package-install-upgrade-built-in t)

(require 'elpaca-setup)
#+end_src

** Custom File
#+begin_src emacs-lisp
(setq custom-file (expand-file-name "emacs-custom.el" user-emacs-directory))
(add-hook 'elpaca-after-init-hook (lambda () (load custom-file 'noerror)))

;; Load custom.el early (before packages) for environment variables like API keys
(setq ismd/custom-file (expand-file-name "custom.el" user-emacs-directory))
(load ismd/custom-file 'noerror)
#+end_src

** Fonts
#+begin_src emacs-lisp
(setq ismd/mono-font "FiraCode Nerd Font"
      ismd/variable-font "FiraCode Nerd Font"
      ismd/font-size 130
      ismd/variable-font-size 140)

(defun ismd/set-fonts ()
  "Set the fonts for Emacs."
  (set-face-attribute 'default nil
                      :font ismd/mono-font
                      :height ismd/font-size)
  (set-face-attribute 'variable-pitch nil
                      :font ismd/variable-font
                      :height ismd/variable-font-size)
  (set-face-attribute 'fixed-pitch nil
                      :inherit 'default)

  (set-face-attribute 'font-lock-comment-face nil
                      :slant 'italic)
  (set-face-attribute 'font-lock-keyword-face nil
                      :slant 'italic)

  ;; tab-bar
  (set-face-attribute 'tab-bar-tab nil
                      :inherit 'unspecified)

  (setq use-default-font-for-symbols nil)
  (set-fontset-font t 'emoji
                    (font-spec :family "Noto Color Emoji")
                    nil 'prepend))

(if (daemonp)
    (add-hook 'after-make-frame-functions
              (lambda (frame)
                (with-selected-frame frame
                  (ismd/set-fonts))))
  (ismd/set-fonts))

(add-to-list 'default-frame-alist
             `(font . ,(format "%s-%d" ismd/mono-font (/ ismd/font-size 10))))
#+end_src

** Themes
*** Init Themes
#+begin_src emacs-lisp
(org-babel-load-file
  (expand-file-name "modules/themes.org" user-emacs-directory))
#+end_src

*** Load Theme
#+begin_src emacs-lisp
(defvar theme-name 'ef-owl "The name of the theme to use")
(when (file-exists-p "~/.config/emacs/theme.el")
  (load-file "~/.config/emacs/theme.el"))

(add-hook 'elpaca-after-init-hook
          (lambda ()
            (load-theme theme-name t)))
#+end_src

* Load Modules
#+begin_src emacs-lisp
(defun ismd/load-module (name)
  "Load a configuration module from modules directory."
  (org-babel-load-file
   (expand-file-name (concat "modules/" name ".org") user-emacs-directory)))

;; Core modules (load order matters)
(ismd/load-module "core")        ;; Sane defaults, utilities
(ismd/load-module "ui")          ;; Fonts, icons, modeline
(ismd/load-module "completion")  ;; Vertico, Corfu, Consult
(ismd/load-module "keybindings") ;; General keybindings

;; ;; Feature modules
(ismd/load-module "ai")         ;; Claude, Copilot, GPTel
(ismd/load-module "files")      ;; Dired, treemacs, project
(ismd/load-module "languages")  ;; Eglot, treesit, languages
(ismd/load-module "org-config") ;; Org mode settings
(ismd/load-module "shells")     ;; Vterm, eshell
(ismd/load-module "vcs")        ;; Magit, git-gutter
#+end_src

* Daemon
#+begin_src emacs-lisp
(server-start)
#+end_src
